
<% if @d_object['random'].nil? %>
<%= @d_object.id %>
<% @d_object.references.each do |r| %>
 <%= content_tag(:li, "#{r.attachable_type} => #{r.attachable_id}") %>
<% end %>

<% else %>

<% content_tag(:div, attachments_render(@d_object.references)) %>

<%=
  lista=[]
  track=@d_object.get_tracklist.sample
  cnt=@d_object.get_tracklist.index(track)+1
  if @d_object.audioclip_exists?(cnt)
    lista << content_tag(:li, link_to("#{track[:attributes]['position']}. #{track['title'].reverse}", %Q{http://#{request.host_with_port}#{d_object_path(@d_object, format: 'mp3', t: cnt)}}))
  else
    lista << content_tag(:li, "#{track[:attributes]['position']}. #{track['title']}")
  end
  # javascript_include_tag('http://clavisbct.comperio.it/player.js')
  lista = lista.join.html_safe
  content_tag(:div, content_tag(:ul, lista, :style=>'list-style: none')) + content_tag(:p, @d_object.filename)
  content_tag(:div, content_tag(:ul, lista, :style=>'list-style: none')) + content_tag(:p, File.basename(@d_object.filename))
  content_tag(:div, content_tag(:ul, lista, :style=>'list-style: none'))
%>


<% if !@d_object.references.first.nil? %>

  <% if @d_object.references.first.attachable_type=='ClavisManifestation' %>
    <div id="rivela_il_mistero" style="display:none">
    <%= content_tag(:div, clavis_manifestation_opac_preview(@d_object.references.first.attachable)) %>
    <%= content_tag(:div, attachments_render(@d_object.references.first.attachable.attachments)) %>
    </div>
    <div id="fra_pochi_secondi">
      Fra pochi secondi ti dir√≤ di che brano si tratta...
    </div>
<script>
setTimeout(function() {
jQuery('#fra_pochi_secondi').fadeOut(1000);
jQuery('#rivela_il_mistero').fadeIn(2000);
}, 30000);
</script>


  <% end %>
<% else %>
  <%= content_tag(:p, @d_object.references.inspect) %>
<% end %>
<% end %>


