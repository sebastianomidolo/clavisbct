% Template per stampa catalogo topografico

\documentclass[a4paper,10pt]{article}

% \usepackage[a4paper]{geometry}


\usepackage[a4paper, top=20mm, bottom=10mm, left=1.0cm, right=1.25in]{geometry}

\usepackage{fancyhdr}
\setlength{\headheight}{1pt}
\pagestyle{fancy}


\textwidth=20cm

% \rhead{Prova \LaTeX}

% \usepackage[utf8]{inputenc}
\usepackage[utf8x]{inputenc}

% \usepackage{multicol}

\linespread{1.3}

\textheight=28cm

\usepackage{supertabular}


\renewcommand{\headrulewidth}{0pt}
\pagestyle{fancy}

<%= "\\chead{#{inputdata.titolo_elenco} --- Stampa: #{Time.now.to_date}}" %>

\lfoot{}
\cfoot{}
\rfoot{}



\begin{document}


% \pagestyle{empty}

% \head{x}

%\tablehead{\hline}
%\tabletail{\hline}

\begin{supertabular}{l|p{24mm}|p{120mm}|l}
<%
 res=[]	
 cnt=1
 compact = inputdata.length > 60 ? true : false
 prec_piano=nil
 inputd = inputdata.drop(1)
 inputd.each do |e|
   e['title'].gsub!("&", '\\\&')
   e['title'].gsub!("%", '\\\%')
   e['title'].gsub!(">", '$>$')
   if e['title'] =~ /Nuova collocazione/
     e['title'] = "Ricollocato: #{e['title'][23..60]}"
   end
   if !prec_piano.nil? and prec_piano!=e.loc_name and compact
     res << "--- & --- & --- \\\\"
   end
   prec_piano=e.loc_name
   coll = e.collocazione
   coll.sub!(/^BCT\./,'')
   coll = coll.split('(').join("\\\\")
   coll = coll[0..18]

   note = e['note_interne']
   # title = e['title'][0..170]
   title = e['title']
   if e.manifestation_id==0
      media = "Fuori cat."
   else
      media = e.item_media_type.nil? ? 'Media type ignoto' : e.item_media_type
   end
   media << "\\newline #{e.item_status}" if !e.item_status.blank?
   media << "\\newline #{e.loan_status}" if !e.loan_status.blank?

   serieinv = e.inventory_number.blank? ? '---' : "#{e.inventory_serie_id}-#{e.inventory_number}"
   res << "#{coll} & #{media} & #{title} & #{serieinv} \\\\"
   cnt+=1
 end
%>
<%= res.join("\n") %>

\end{supertabular}

\end{document}
